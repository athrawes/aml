Effect = use "Control/Effect"

module Async :> Effect

type :resolved<'a>
type :pending<'a> of (_ -> :resolved<'a>)

type :async<'a> =
  | :resolved<'a>
  | :pending<'a>

from = :resolved

then : :async<'a> -> ('a -> :async<'b>) -> :async<'b>
then = self callback ->
  match self
  | :resolved [_] => callback self
  | :pending [suspended] => :pending (_ -> then (suspended _) callback)
